{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-header card-header-custom text-white">
      <h5>Detalhes do Fornecedor</h5>
    </div>
    <div class="card-body">
      <p><strong>Nome:</strong> {{ fornecedor.nome }}</p>
      <p><strong>Setor de Atuação:</strong> {{ fornecedor.setor_de_atuacao }}</p>
      <p><strong>CPF/CNPJ:</strong> {{ fornecedor.cpf_cnpj }}</p>
      <p><strong>Endereço:</strong> {{ fornecedor.endereco }}</p>
      <p><strong>Telefone:</strong> {{ fornecedor.telefone }}</p>
      <p><strong>E-mail:</strong> {{ fornecedor.email }}</p>
      <p><strong>Informações bancárias:</strong> {{ fornecedor.informacoes_bancarias }}</p>
      <p><strong>Ponto Focal:</strong> {{ fornecedor.ponto_focal }}</p>
      <p><strong>E-mail do Ponto Focal:</strong> {{ fornecedor.email_focal }}</p>
      <p><strong>Telefone do Ponto Focal:</strong> {{ fornecedor.telefone_focal }}</p>
      {% if fornecedor.observacao %}
        <p><strong>Observações do Fornecedor:</strong> {{ fornecedor.observacao }}</p>
      {% endif %}
    </div>
  </div>

  <hr>
    <!-- Indicadores gerais do fornecedor -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-secondary text-white">
        Indicadores Gerais do Fornecedor
      </div>
      <div class="card-body">
        <p><strong>Contratos Ativos:</strong> {{ contratos|length }}</p>

        <!-- IQ -->
        <div class="d-flex align-items-center mb-2">
            <strong class="me-2" style="min-width: 220px;">Índice de Qualidade:</strong>
            <span class="me-2" style="width:70px;">{{ indicadores_geral.IQ|floatformat:2 }}%</span>

            <div class="progress flex-grow-1" style="height: 14px;">
                <div class="progress-bar
                    {% if indicadores_geral.IQ < 50 %}bg-danger
                    {% elif indicadores_geral.IQ < 80 %}bg-warning
                    {% else %}bg-success{% endif %}"
                    style="width: {{ indicadores_geral.IQ|floatformat:2|cut:","|slice:":-2" }}.{{ indicadores_geral.IQ|floatformat:2|cut:","|slice:"-2:" }}%;">
                </div>
            </div>
        </div>

        <!-- IP -->
        <div class="d-flex align-items-center mb-2">
            <strong class="me-2" style="min-width: 220px;">Índice de Pontualidade:</strong>
            <span class="me-2" style="width:70px;">{{ indicadores_geral.IP|floatformat:2 }}%</span>

            <div class="progress flex-grow-1" style="height: 14px;">
                <div class="progress-bar
                    {% if indicadores_geral.IP < 50 %}bg-danger
                    {% elif indicadores_geral.IP < 80 %}bg-warning
                    {% else %}bg-success{% endif %}"
                    style="width: {{ indicadores_geral.IP|floatformat:2|cut:","|slice:":-2" }}.{{ indicadores_geral.IP|floatformat:2|cut:","|slice:"-2:" }}%;">
                </div>
            </div>
        </div>

        <!-- INC -->
        <div class="d-flex align-items-center mb-3">
            <strong class="me-2" style="min-width: 220px;">Índice de Entregas Não Conformes:</strong>
            <span class="me-2" style="width:70px;">{{ indicadores_geral.INC|floatformat:2 }}%</span>

            <div class="progress flex-grow-1" style="height: 14px;">
                <div class="progress-bar
                    {% if indicadores_geral.INC < 50 %}bg-danger
                    {% elif indicadores_geral.INC < 80 %}bg-warning
                    {% else %}bg-success{% endif %}"
                    style="width: {{ indicadores_geral.INC|floatformat:2|cut:","|slice:":-2" }}.{{ indicadores_geral.INC|floatformat:2|cut:","|slice:"-2:" }}%;">
                </div>
            </div>
        </div>

        <hr>

        <!-- IS técnica -->
        <div class="d-flex align-items-center mb-2">
            <strong class="me-2" style="min-width: 220px;">Índice de Satisfação Técnica:</strong>
            <span class="me-2" style="width:70px;">{{ indicadores_geral.IS_tecnica|floatformat:2 }}%</span>

            <div class="progress flex-grow-1" style="height: 14px;">
                <div class="progress-bar
                    {% if indicadores_geral.IS_tecnica < 50 %}bg-danger
                    {% elif indicadores_geral.IS_tecnica < 80 %}bg-warning
                    {% else %}bg-success{% endif %}"
                    style="width: {{ indicadores_geral.IS_tecnica|floatformat:2|cut:","|slice:":-2" }}.{{ indicadores_geral.IS_tecnica|floatformat:2|cut:","|slice:"-2:" }}%;">
                </div>
            </div>
        </div>

        <!-- IS gestão -->
        <div class="d-flex align-items-center mb-2">
            <strong class="me-2" style="min-width: 220px;">Índice de Satisfação Gestão:</strong>
            <span class="me-2" style="width:70px;">{{ indicadores_geral.IS_gestao|floatformat:2 }}%</span>

            <div class="progress flex-grow-1" style="height: 14px;">
                <div class="progress-bar
                    {% if indicadores_geral.IS_gestao < 50 %}bg-danger
                    {% elif indicadores_geral.IS_gestao < 80 %}bg-warning
                    {% else %}bg-success{% endif %}"
                    style="width: {{ indicadores_geral.IS_gestao|floatformat:2|cut:","|slice:":-2" }}.{{ indicadores_geral.IS_gestao|floatformat:2|cut:","|slice:"-2:" }}%;">
                </div>
            </div>
        </div>

        <!-- IS entrega -->
        <div class="d-flex align-items-center mb-2">
            <strong class="me-2" style="min-width: 220px;">Índice de Satisfação Entrega:</strong>
            <span class="me-2" style="width:70px;">{{ indicadores_geral.IS_entrega|floatformat:2 }}%</span>

            <div class="progress flex-grow-1" style="height: 14px;">
                <div class="progress-bar
                    {% if indicadores_geral.IS_entrega < 50 %}bg-danger
                    {% elif indicadores_geral.IS_entrega < 80 %}bg-warning
                    {% else %}bg-success{% endif %}"
                    style="width: {{ indicadores_geral.IS_entrega|floatformat:2|cut:","|slice:":-2" }}.{{ indicadores_geral.IS_entrega|floatformat:2|cut:","|slice:"-2:" }}%;">
                </div>
            </div>
        </div>

      </div>
    </div>


  <hr>
  <div class="card shadow-sm">
    <div class="card-header card-header-custom text-white">
      <h5>Contratos Vinculados</h5>
    </div>

    {% if contratos %}
      <table class="table table-striped mt-3">
        <thead>
          <tr>
            <th>Projeto</th>
            <th>Coordenador</th>
            <th>Data de Início</th>
            <th>Data de Fim</th>
            <th>Valor Total</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for contrato in contratos %}
            <tr>
              <td>{{ contrato.cod_projeto }}</td>
              <td>{{ contrato.coordenador }}</td>
              <td>{{ contrato.data_inicio|date:"d/m/Y" }}</td>
              <td>{{ contrato.data_fim|date:"d/m/Y" }}</td>
              {% if contrato.valor_total %}
                <td>R$ {{ contrato.valor_total|floatformat:2 }}</td>
              {% else %}
                <td>Não informado</td>
              {% endif %}
              <td>{{ contrato.get_status_display }}</td>
              <td>
                <a href="{% url 'contrato_fornecedor_detalhe' contrato.pk %}" class="btn btn-sm btn-outline-primary">
                  Ver Detalhes
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">Nenhum contrato vinculado a este fornecedor.</p>
    {% endif %}
  </div>

  <hr>

  <div class="card shadow-sm">
    <div class="card-header card-header-custom text-white">
      <h5>Ordens de Serviços Vinculadas</h5>
    </div>

    {% if os %}
      <table class="table table-striped mt-3">
        <thead>
          <tr>
            <th>Projeto</th>
            <th>Coordenador</th>
            <th>Prazo de Execução</th>
            <th>Valor Total</th>
            <th>Status</th>
            <th>Arquivo</th>
          </tr>
        </thead>
        <tbody>
          {% for ordem in os %}
            <tr>
              <td>{{ ordem.cod_projeto }}</td>
              <td>{{ ordem.coordenador }}</td>
              <td>{{ ordem.prazo_execucao|date:"d/m/Y" }}</td>
              {% if ordem.valor %}
                <td>R$ {{ ordem.valor|floatformat:2 }}</td>
              {% else %}
                <td>Não informado</td>
              {% endif %}
              <td>{{ ordem.get_status_display }}</td>
              <td>
                <a href="{{ ordem.arquivo_os.url }}" class="btn btn-sm btn-outline-primary">
                  Arquivo OS
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">Nenhuma OS vinculada a este fornecedor.</p>
    {% endif %}
  </div>

  <hr>
  <div class="card-footer text-end">
    <a href="{% url 'lista_fornecedores' %}" class="btn btn-custom">← Voltar</a>
  </div>
</div>
{% endblock %}
