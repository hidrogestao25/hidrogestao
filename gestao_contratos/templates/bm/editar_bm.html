<form id="formEditarBM" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
</form>

<div class="mt-3 d-flex justify-content-end gap-2">
    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    <button class="btn btn-success" id="btnSalvarBM">Salvar</button>
</div>

<script>
document.getElementById("btnSalvarBM").addEventListener("click", function() {

    const form = document.getElementById("formEditarBM");
    const fd = new FormData(form);

    fetch("{% url 'editar_bm' bm.id %}", {
        method: "POST",
        body: fd
    })
    .then(r => r.json())
    .then(data => {
        if (data.success !== false) {
            bootstrap.Modal.getInstance(document.getElementById("editarBMModal")).hide();
            location.reload();
        } else {
            alert("Erro ao salvar:\n" + Object.values(data.errors).flat().join("\n"));
        }
    });
});
</script>
